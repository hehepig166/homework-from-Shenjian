/* 朱泽凯 2051995 济美 */
#define _CRT_SECURE_NO_WARNINGS
#include <stdio.h>
#include <stdlib.h>

/// 存一个学生的信息
struct student {
    int no;         //学号，不考虑0开头
    char name[9];   //姓名，最长4个双字节汉字
    int score;      //成绩，不考虑小数点
    int rank;       //名次
};

/// 排序
/// [ begin, end )
/// cmp(*begin, *end) != 0
void student_sort(struct student *begin, struct student *end, int (*_cmp)(const struct student *lhs, const struct student *rhs))
{
    struct student *i, *j, *tmp;
    struct student buf;
    for (i = begin; i < end; i++) {

        //找更优
        for (j = tmp = i; j < end; j++)
            if (_cmp(j, tmp))
                tmp = j;

        //交换
        if (i != tmp) {
            buf = *i;
            *i = *tmp;
            *tmp = buf;
        }
    }
}

/// 第一关键字为 score (大更优)
/// 第二关键字为 name  (小更优)
int cmp(const struct student *lhs, const struct student *rhs)
{
    return lhs->score == rhs->score ? lhs->no < rhs->no : lhs->score > rhs->score;
}

/// no排序(小更优)
int cmp_no(const struct student *lhs, const struct student *rhs)
{
    return lhs->no < rhs->no;
}

/// 排序并计算rank
/// 要求 [begin,end) 地址合法
void getrank(struct student *begin, struct student *end)
{
    //双关键字排序
    student_sort(begin, end, cmp);

    //计算rank
    int cnt;
    struct student *lst;
    struct student *cur=begin;
    cur->rank = cnt = 1;
    lst = cur;
    for (cur++, cnt++; cur < end; cnt++, cur++) {
        if (cur->score == lst->score) {
            cur->rank = lst->rank;
        }
        else {
            cur->rank = cnt;
            lst = cur;
        }
    }

    //按学号排序
    student_sort(begin, end, cmp_no);
}

/// 初始化，读入 *_n(人数)，并读入_n个人的信息返回一个数组头指针
struct student *input(int *_n)
{
    FILE *fin;
    struct student *p;

    //打开文件
    if ((fin = fopen("student.txt", "r")) == NULL) {
        fprintf(stderr, "打开文件 student.txt 失败\n");
        return NULL;
    }

    //分配空间
    if (fscanf(fin, "%d", _n) != 1) {
        fclose(fin);
        return NULL;
    }
    if ((p = (struct student*)malloc(*_n * sizeof(struct student))) == NULL) {
        fprintf(stderr, "分配空间失败\n");
        fclose(fin);
        return NULL;
    }

    //读入数据
    for (int i = 0; i < *_n; i++)
        if (fscanf(fin, "%d%s%d", &p[i].no, p[i].name, &p[i].score) != 3) {
            free(p);
            fclose(fin);
            return NULL;
        }

    //返回指针
    fclose(fin);
    return p;
}

int main()
{
    int n;
    struct student *p;

    //读入
    if ((p = input(&n)) == NULL)
        return 1;

    //排序并计算rank
    getrank(p, p + n);

    //得到rank

    //输出
    for (int i = 0; i < n; i++)
        printf("%d %s %d %d\n", p[i].no, p[i].name, p[i].score, p[i].rank);

    //释放
    free(p);

    return 0;
}